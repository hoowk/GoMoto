<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoMoto - Rastreamento</title>
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css">
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <style>
        body, html { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #status {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
        }
        .toggle-container {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="status"></div>
    <div class="toggle-container">
        <div id="toggle">Ativar Rastreamento</div>
    </div>

    <script>
        // Verifica login
        if(!localStorage.getItem("motoboyNome")) {
            window.location.href = "login.html";
        }

        // Mostra nome do motoboy
        document.getElementById("status").textContent = localStorage.getItem("motoboyNome");

        // Inicializa mapa
        const map = new maplibregl.Map({
            container: 'map',
            style: 'https://api.maptiler.com/maps/streets-v2/style.json?key=kEB2a1outAjGbGUoNn6x',
            center: [-48.5487, -27.5928],
            zoom: 14
        });

        // Controle de rastreamento
        let tracking = false;
        document.getElementById('toggle').addEventListener('click', function() {
            tracking = !tracking;
            this.textContent = tracking ? "Desativar Rastreamento" : "Ativar Rastreamento";
            
            if(!tracking) {
                localStorage.removeItem("motoboyNome");
                window.location.href = "login.html";
            }
        });

        // Atualiza localização
        if(navigator.geolocation) {
            navigator.geolocation.watchPosition((position) => {
                if(tracking) {
                    const coords = [position.coords.longitude, position.coords.latitude];
                    new maplibregl.Marker()
                        .setLngLat(coords)
                        .addTo(map);
                    map.flyTo({ center: coords, zoom: 16 });
                }
            });
        }
    </script>
</body>
</html>
